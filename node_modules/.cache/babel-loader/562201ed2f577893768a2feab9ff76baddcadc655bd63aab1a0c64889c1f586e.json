{"ast":null,"code":"// src/pages/OtpVerification.jsx\nimport React,{useEffect,useState}from'react';import{useLocation,useNavigate}from'react-router-dom';import{authAPI}from'../api/apiService';import'../styles/Login.css';import logo from'../assets/rightlogo.png';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const OtpVerification=()=>{/* ───────── STATE ───────── */const[otp,setOtp]=useState('');const[timer,setTimer]=useState(30);// 30‑second cooldown\nconst[canResend,setCanResend]=useState(false);const navigate=useNavigate();const location=useLocation();let{target,type}=location.state||{};// { target, type: \"userId\" | \"password\" }\n// Fallback to sessionStorage so refresh/direct visit still works\nif(!target||!type){try{const saved=JSON.parse(sessionStorage.getItem('otpFlow')||'null');if(saved!==null&&saved!==void 0&&saved.target&&saved!==null&&saved!==void 0&&saved.type){target=saved.target;// eslint-disable-line prefer-const\ntype=saved.type;// eslint-disable-line prefer-const\n}}catch(_){}}/* ───────── GUARD ───────── */useEffect(()=>{if(!target||!type){alert('Invalid navigation – redirecting.');navigate('/forgot-password');}},[target,type,navigate]);/* ───────── TIMER ───────── */useEffect(()=>{if(timer===0){setCanResend(true);return;}const id=setInterval(()=>setTimer(t=>t-1),1000);return()=>clearInterval(id);},[timer]);/* ───────── VERIFY ───────── */const handleVerify=async()=>{if(otp.length!==6){alert('Enter a 6‑digit OTP');return;}try{// Backend expects emailOrPhone\nawait authAPI.verifyOTP({email:target,otp});alert('OTP verified ✔️');try{sessionStorage.setItem('otpFlow',JSON.stringify({target,type,otpVerified:true}));}catch(_){}if(type==='userId'){navigate('/change-userid',{state:{target}});}else{navigate('/change-password',{state:{target}});}}catch(err){console.error(err);alert('Invalid or expired OTP.');}};/* ───────── RESEND ───────── */const handleResend=async()=>{if(!canResend)return;try{await authAPI.resendOTP(target);alert('OTP resent!');setTimer(30);setCanResend(false);setOtp('');}catch(err){console.error(err);alert('Could not resend OTP.');}};/* ───────── UI ───────── */const getCurrentDate=()=>new Date().toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'});return/*#__PURE__*/_jsx(\"div\",{className:\"login-page-container minimalist\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"auth-wrapper\",children:[/*#__PURE__*/_jsxs(\"aside\",{className:\"agri-highlights\",\"aria-label\":\"Agriculture highlights\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"agri-title\",children:\"Verify your identity\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"agri-list\",children:/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"agri-emoji\",children:\"\\u2709\\uFE0F\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"agri-point\",children:\"6\\u2011digit code sent\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"agri-sub\",children:[\"To: \",target]})]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"auth-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"auth-brand\",children:[/*#__PURE__*/_jsx(\"img\",{src:logo,alt:\"DATE Logo\",className:\"auth-logo\"}),/*#__PURE__*/_jsx(\"div\",{className:\"auth-title\",children:\"Digital Agristack Transaction Enterprises\"}),/*#__PURE__*/_jsx(\"div\",{className:\"auth-subtitle\",children:\"Empowering Agricultural Excellence\"})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:e=>{e.preventDefault();handleVerify();},className:\"auth-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"auth-field\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"otpInput\",children:\"Enter OTP\"}),/*#__PURE__*/_jsx(\"input\",{id:\"otpInput\",className:\"otp-input\",maxLength:6,value:otp,onChange:e=>setOtp(e.target.value.replace(/\\D/g,''))})]}),/*#__PURE__*/_jsx(\"div\",{className:\"resend-otp\",children:canResend?/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleResend,className:\"resend-btn\",children:\"Resend OTP\"}):/*#__PURE__*/_jsxs(\"span\",{className:\"resend-timer\",children:[\"Resend in \",timer,\"s\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"auth-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"auth-submit\",children:\"Verify\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"auth-secondary\",onClick:()=>navigate(-1),children:\"Back\"})]})]})]})]})});};export default OtpVerification;","map":{"version":3,"names":["React","useEffect","useState","useLocation","useNavigate","authAPI","logo","jsx","_jsx","jsxs","_jsxs","OtpVerification","otp","setOtp","timer","setTimer","canResend","setCanResend","navigate","location","target","type","state","saved","JSON","parse","sessionStorage","getItem","_","alert","id","setInterval","t","clearInterval","handleVerify","length","verifyOTP","email","setItem","stringify","otpVerified","err","console","error","handleResend","resendOTP","getCurrentDate","Date","toLocaleDateString","weekday","year","month","day","className","children","src","alt","onSubmit","e","preventDefault","htmlFor","maxLength","value","onChange","replace","onClick"],"sources":["C:/karthik cc/date-frontend/src/pages/OtpVerification.jsx"],"sourcesContent":["// src/pages/OtpVerification.jsx\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { authAPI } from '../api/apiService';\r\nimport '../styles/Login.css';\r\nimport logo from '../assets/rightlogo.png';\r\n \r\nconst OtpVerification = () => {\r\n  /* ───────── STATE ───────── */\r\n  const [otp,         setOtp]         = useState('');\r\n  const [timer,       setTimer]       = useState(30);  // 30‑second cooldown\r\n  const [canResend,   setCanResend]   = useState(false);\r\n \r\n  const navigate  = useNavigate();\r\n  const location  = useLocation();\r\n  let { target, type } = location.state || {};        // { target, type: \"userId\" | \"password\" }\r\n  // Fallback to sessionStorage so refresh/direct visit still works\r\n  if (!target || !type) {\r\n    try {\r\n      const saved = JSON.parse(sessionStorage.getItem('otpFlow') || 'null');\r\n      if (saved?.target && saved?.type) {\r\n        target = saved.target; // eslint-disable-line prefer-const\r\n        type = saved.type;     // eslint-disable-line prefer-const\r\n      }\r\n    } catch (_) {}\r\n  }\r\n \r\n  /* ───────── GUARD ───────── */\r\n  useEffect(() => {\r\n    if (!target || !type) {\r\n      alert('Invalid navigation – redirecting.');\r\n      navigate('/forgot-password');\r\n    }\r\n  }, [target, type, navigate]);\r\n \r\n  /* ───────── TIMER ───────── */\r\n  useEffect(() => {\r\n    if (timer === 0) { setCanResend(true); return; }\r\n    const id = setInterval(() => setTimer(t => t - 1), 1_000);\r\n    return () => clearInterval(id);\r\n  }, [timer]);\r\n \r\n  /* ───────── VERIFY ───────── */\r\n  const handleVerify = async () => {\r\n    if (otp.length !== 6) { alert('Enter a 6‑digit OTP'); return; }\r\n    try {\r\n      // Backend expects emailOrPhone\r\n      await authAPI.verifyOTP({ email: target, otp });\r\n      alert('OTP verified ✔️');\r\n      try {\r\n        sessionStorage.setItem('otpFlow', JSON.stringify({ target, type, otpVerified: true }));\r\n      } catch (_) {}\r\n      if (type === 'userId') {\r\n        navigate('/change-userid', { state: { target } });\r\n      } else {\r\n        navigate('/change-password', { state: { target } });\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert('Invalid or expired OTP.');\r\n    }\r\n  };\r\n \r\n  /* ───────── RESEND ───────── */\r\n  const handleResend = async () => {\r\n    if (!canResend) return;\r\n    try {\r\n      await authAPI.resendOTP(target);\r\n      alert('OTP resent!');\r\n      setTimer(30);\r\n      setCanResend(false);\r\n      setOtp('');\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert('Could not resend OTP.');\r\n    }\r\n  };\r\n \r\n  /* ───────── UI ───────── */\r\n  const getCurrentDate = () => new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });\r\n\r\n  return (\r\n    <div className=\"login-page-container minimalist\">\r\n      <div className=\"auth-wrapper\">\r\n        <aside className=\"agri-highlights\" aria-label=\"Agriculture highlights\">\r\n          <h2 className=\"agri-title\">Verify your identity</h2>\r\n          <ul className=\"agri-list\">\r\n            <li><span className=\"agri-emoji\">✉️</span><div><div className=\"agri-point\">6‑digit code sent</div><div className=\"agri-sub\">To: {target}</div></div></li>\r\n          </ul>\r\n        </aside>\r\n        <div className=\"auth-card\">\r\n          <div className=\"auth-brand\">\r\n            <img src={logo} alt=\"DATE Logo\" className=\"auth-logo\" />\r\n            <div className=\"auth-title\">Digital Agristack Transaction Enterprises</div>\r\n            <div className=\"auth-subtitle\">Empowering Agricultural Excellence</div>\r\n          </div>\r\n          <form onSubmit={(e) => { e.preventDefault(); handleVerify(); }} className=\"auth-form\">\r\n            <div className=\"auth-field\">\r\n              <label htmlFor=\"otpInput\">Enter OTP</label>\r\n              <input id=\"otpInput\" className=\"otp-input\" maxLength={6} value={otp} onChange={e => setOtp(e.target.value.replace(/\\D/g, ''))} />\r\n            </div>\r\n            <div className=\"resend-otp\">\r\n              {canResend ? (\r\n                <button type=\"button\" onClick={handleResend} className=\"resend-btn\">Resend OTP</button>\r\n              ) : (\r\n                <span className=\"resend-timer\">Resend in {timer}s</span>\r\n              )}\r\n            </div>\r\n            <div className=\"auth-actions\">\r\n              <button type=\"submit\" className=\"auth-submit\">Verify</button>\r\n              <button type=\"button\" className=\"auth-secondary\" onClick={() => navigate(-1)}>Back</button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n \r\nexport default OtpVerification; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}